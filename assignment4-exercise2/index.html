<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        let ws

        let initBol
        let warningsOn
        let minimumSeverity = 0

        const addWarning = (text) => {
            const li = document.createElement('li')
            li.setAttribute("id", `${text.id}`)
            li.innerText = JSON.stringify(text)
            document.querySelector('#warnings').appendChild(li)
        }
        const updateWarning = (element, newData) => {
            const a = document.createElement('a')
            a.innerText = JSON.stringify(newData)
            element.appendChild(a)
        }

        const initData = message => {
            let json = JSON.parse(message.data)

            json.warnings.forEach(warning => {addWarning(warning)})
            initBol = false
        }

        window.helper = () => {
            location.reload();
        }

        window.unSubscribe = () =>{
            ws.onopen = () => {
                const message = "unsubscribe"
                ws.send(message)
            }
            ws.onmessage = message => {
                console.log(message)
            }
        }

        window.warningsOnOff = () => {
            if(warningsOn===true){
                unSubscribe()
                document.getElementById("warnings").style.display = "none"
                warningsOn=false
            }else {
                location.reload()
                warningsOn=true
            }
        }

        window.setMinSeverity = () => {
            minimumSeverity = document.getElementById("minSeverity").value
        }

        window.init = () => {
            console.log("something")
            ws = new WebSocket("ws://localhost:8090/warnings")
            ws.onopen = () => {
                const message = "subscribe"
                ws.send(message)
                initBol = true
                warningsOn = true
            }
            ws.onmessage = message => {
                console.log("new data")
                if(initBol){
                    initData(message)
                }else {
                    let json = JSON.parse(message.data)
                    let element = document.getElementById(`${json.id}`)



                    if (element === null) {
                        addWarning(json)
                    } else {
                        updateWarning(element, json)
                    }
                }
            }
        }
    </script>
</head>
<body onload="init()">
<div>
    <button onclick="warningsOnOff()">Warnings on/off</button>
</div>

<div>
    Minimum severity
    <input type="text" id="minSeverity">
    <button onclick="setMinSeverity()">Set min severity fot warnings</button>
</div>

<div>
    <button onclick="helper()">Help</button>
</div>
<div>
    Warnings:<br>
    <ul id="warnings"></ul>
</div>

</body>
</html>