<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        let ws
        let init = true

        const addWarning = (text) => {
            const li = document.createElement('li')
            li.setAttribute("id", `${text.id}`)
            li.innerText = JSON.stringify(text)
            document.querySelector('#warnings').appendChild(li)
        }
        const updateWarning = (element, newData) => {
            const a = document.createElement('a')
            a.innerText = JSON.stringify(newData)
            element.appendChild(a)
        }

        const initData = message => {
            let json = JSON.parse(message.data)

            json.warnings.forEach(warning => {
                let element = document.getElementById(`${warning.id}`)
                if (element === null) {
                    addWarning(warning)
                } else {
                    updateWarning(element, warning)
                }
                // addWarning(warning)
            })
            init = false
        }

        window.helper = () => {
            let element = document.getElementById('1')
            updateWarning(element, "test")
        }

        window.subscribe = () => {

            ws = new WebSocket("ws://localhost:8090/warnings")
            ws.onopen = () => {
                const message = "subscribe"
                ws.send(message)
            }
            ws.onmessage = message => {
                console.log("new data")
                if(init){
                    initData(message)
                }else {
                    let json = JSON.parse(message.data)
                    let element = document.getElementById(`${json.id}`)
                    if (element === null) {
                        addWarning(json)
                    } else {
                        updateWarning(element, json)
                    }
                }
            }
        }
    </script>
</head>
<body>
<div id='subscribe'>
    <button onclick='subscribe()'>Subscribe</button>
</div>
<div>
    <button onclick="helper()">Help</button>
</div>
<div>
    Warnings:<br>
    <ul id="warnings"></ul>
</div>

</body>
</html>